<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>English Quest Lular üêºüß©</title>
<style>
/* Estilos CSS */
body {
    font-family: 'Inter', Arial, sans-serif;
    background: #ffffff;
    display: flex;
    flex-direction: column;
    align-items: center;
    margin: 0;
    padding: 20px;
    transition: background-color 0.4s ease;
}
h1 { 
    text-align: center; 
    color: #0b009f; /* Color primario */
    margin-top: 0;
    margin-bottom: 25px;
    font-size: 2.5rem;
}
h3 {
    color: #333;
    margin-top: 20px;
    margin-bottom: 15px;
    font-weight: 600;
}
.menu, .game, .scoreboard { 
    display: none; 
    margin-top: 10px; 
    text-align: center; 
    background: #f0f4ff;
    padding: 20px;
    border-radius: 20px;
    box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
    max-width: 90%;
}
.menu-btn {
    display: inline-block;
    margin: 6px;
    padding: 12px 25px;
    font-size: 16px;
    cursor: pointer;
    border-radius: 12px;
    border: none;
    background-color: #0b009f;
    color: #fff;
    transition: all 0.2s ease;
    box-shadow: 0 4px #070066;
}
.menu-btn:hover { 
    background-color: #00bfff; 
    box-shadow: 0 2px #0088cc;
    transform: translateY(2px);
}

/* üåü NUEVO: ESTILO PARA BOTONES SELECCIONADOS */
.menu-btn.selected {
    background-color: #00bfff; /* Color claro para indicar selecci√≥n */
    border: 3px solid #000000; /* Borde oscuro para resaltarlo */
    transform: scale(1.05); /* Efecto de que est√° presionado */
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
}

.word-btn {
    display: inline-block;
    margin: 10px;
    padding: 15px 25px;
    font-size: 20px;
    cursor: pointer;
    border-radius: 10px;
    border: none;
    background-color: #ffa07a;
    color: #fff;
    transition: 0.2s;
    min-width: 120px;
    box-shadow: 0 4px #ff6347;
}
.word-btn:hover { 
    background-color: #ff4500; 
    box-shadow: 0 2px #cc3700;
    transform: translateY(2px);
}

#lives, #timer, #score, #highscore { 
    font-size: 20px; 
    margin: 10px; 
    font-weight: bold;
    color: #0b009f;
}

/* Estilo para la pregunta */
#question {
    font-size: 2.2rem;
    margin: 30px 0;
    color: #333;
    font-weight: 700;
}

/* Clases para efectos visuales */
.correct { background-color: #32cd32 !important; color: #fff; box-shadow: 0 4px #1e7e34 !important; } /* Verde para correcto */
.incorrect { background-color: #ff0000 !important; color: #fff; box-shadow: 0 4px #cc0000 !important; } /* Rojo para incorrecto */
.scoreboard h2 { color: #0b009f; font-size: 2rem; }
.scoreboard p { font-size: 18px; line-height: 1.5; color: #555; }
</style>
</head>
<body>

<h1>English Quest Lular üêºüß©</h1>

<div class="menu" id="menu">
    <h3>Elige una categor√≠a</h3>
    <!-- MODIFICADO: Se a√±ade 'this' para pasar el elemento al JS -->
    <button class="menu-btn" onclick="selectCategory('animals', this)">üê∂ Animales</button>
    <button class="menu-btn" onclick="selectCategory('colors', this)">üé® Colores</button>
    <button class="menu-btn" onclick="selectCategory('food', this)">üçé Alimentos</button>
    <button class="menu-btn" onclick="selectCategory('objects', this)">üè† Objetos</button>
    <button class="menu-btn" onclick="selectCategory('clothes', this)">üëï Ropa</button>
    <button class="menu-btn" onclick="selectCategory('vehicles', this)">üöó Veh√≠culos</button>
    <button class="menu-btn" onclick="selectCategory('emotions', this)">üòä Emociones</button>
    <button class="menu-btn" onclick="selectCategory('sports', this)">‚öΩ Deportes</button>
    <button class="menu-btn" onclick="selectCategory('actions', this)">‚úçÔ∏è Acciones</button>

    <h3>Elige dificultad</h3>
    <!-- MODIFICADO: Se a√±ade 'this' para pasar el elemento al JS -->
    <button class="menu-btn" onclick="selectDifficulty('easy', this)">F√°cil (60s)</button>
    <button class="menu-btn" onclick="selectDifficulty('medium', this)">Medio (45s)</button>
    <button class="menu-btn" onclick="selectDifficulty('hard', this)">Dif√≠cil (30s)</button>

    <br><br>
    <button class="menu-btn" onclick="startGame()">Iniciar Juego</button>
</div>

<div class="game" id="game">
    <div id="lives">Vidas: ‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
    <div id="timer">Tiempo: 60</div>
    <div id="score">Puntos: 0</div>
    <div id="highscore">Puntaje m√°s alto: 0</div>
    <h2 id="question"></h2>
    <div id="options"></div>
</div>

<div class="scoreboard" id="scoreboard">
    <!-- El t√≠tulo se actualizar√° en JS (incluye mensaje de p√©rdida) -->
    <h2>¬°Juego terminado! üèÜ</h2> 
    <p id="final-score"></p>
    <p id="final-highscore"></p>
    <p id="final-message"></p>
    <button class="menu-btn" onclick="restartGame()">Volver al men√∫</button>
</div>

<script>
// ====================================================================
// üåé DICCIONARIO DE PALABRAS (WORDS Object)
// ====================================================================

const WORDS = {
    animals: [
        { es: "Perro", en: ["Dog","Cat","Horse"], a:"Dog", emoji:"üê∂" },
        { es: "Gato", en: ["Cat","Cow","Chicken"], a:"Cat", emoji:"üê±" },
        { es: "Caballo", en: ["Horse","Bear","Duck"], a:"Horse", emoji:"üê¥" },
        { es: "Vaca", en: ["Cow","Sheep","Pig"], a:"Cow", emoji:"üêÆ" },
        { es: "Cerdo", en: ["Pig","Goat","Dog"], a:"Pig", emoji:"üê∑" },
        { es: "Oveja", en: ["Sheep","Cat","Rabbit"], a:"Sheep", emoji:"üêë" },
        { es: "Conejo", en: ["Rabbit","Cat","Dog"], a:"Rabbit", emoji:"üê∞" },
        { es: "Mono", en: ["Monkey","Elephant","Lion"], a:"Monkey", emoji:"üêí" },
        { es: "Le√≥n", en: ["Lion","Tiger","Bear"], a:"Lion", emoji:"ü¶Å" },
        { es: "Tigre", en: ["Tiger","Lion","Cat"], a:"Tiger", emoji:"üêØ" },
        { es: "Elefante", en: ["Elephant","Rhino","Hippo"], a:"Elephant", emoji:"üêò" },
        { es: "Zorro", en: ["Fox","Wolf","Bear"], a:"Fox", emoji:"ü¶ä" },
        { es: "Pato", en: ["Duck","Goose","Bird"], a:"Duck", emoji:"ü¶Ü" },
        { es: "Rat√≥n", en: ["Mouse","Rat","Hamster"], a:"Mouse", emoji:"üê≠" },
        { es: "Serpiente", en: ["Snake","Lizard","Worm"], a:"Snake", emoji:"üêç" },
        { es: "Pez", en: ["Fish","Shark","Whale"], a:"Fish", emoji:"üê†" },
        { es: "Jirafa", en: ["Giraffe","Zebra","Deer"], a:"Giraffe", emoji:"ü¶í" },
        { es: "Oso", en: ["Bear","Wolf","Fox"], a:"Bear", emoji:"üêª" },
        { es: "P√°jaro", en: ["Bird","Eagle","Hawk"], a:"Bird", emoji:"üê¶" },
        { es: "Cebra", en: ["Zebra","Donkey","Giraffe"], a:"Zebra", emoji:"ü¶ì" }
    ],
    colors: [
        { es: "Rojo", en: ["Red","Blue","Green"], a:"Red", emoji:"üü•" },
        { es: "Azul", en: ["Blue","Yellow","Green"], a:"Blue", emoji:"üü¶" },
        { es: "Verde", en: ["Green","Red","Blue"], a:"Green", emoji:"üü©" },
        { es: "Amarillo", en: ["Yellow","Red","Green"], a:"Yellow", emoji:"üü®" },
        { es: "Naranja", en: ["Orange","Purple","Blue"], a:"Orange", emoji:"üüß" },
        { es: "Morado", en: ["Purple","Pink","Brown"], a:"Purple", emoji:"üü™" },
        { es: "Rosa", en: ["Pink","Purple","Red"], a:"Pink", emoji:"üå∏" },
        { es: "Negro", en: ["Black","White","Grey"], a:"Black", emoji:"‚¨õ" },
        { es: "Blanco", en: ["White","Black","Grey"], a:"White", emoji:"‚¨ú" },
        { es: "Marr√≥n", en: ["Brown","Yellow","Orange"], a:"Brown", emoji:"üü´" },
        { es: "Gris", en: ["Grey","Black","White"], a:"Grey", emoji:"üîò" },
        { es: "Dorado", en: ["Gold","Silver","Bronze"], a:"Gold", emoji:"ü•á" },
        { es: "Plateado", en: ["Silver","Gold","Gray"], a:"Silver", emoji:"ü•à" },
        { es: "Claro", en: ["Light","Dark","Bright"], a:"Light", emoji:"üí°" },
        { es: "Oscuro", en: ["Dark","Light","Deep"], a:"Dark", emoji:"üåë" }
    ],
    food: [
        { es: "Manzana", en: ["Apple","Banana","Grape"], a:"Apple", emoji:"üçé" },
        { es: "Banana", en: ["Banana","Pear","Orange"], a:"Banana", emoji:"üçå" },
        { es: "Uvas", en: ["Grape","Apple","Orange"], a:"Grape", emoji:"üçá" },
        { es: "Naranja", en: ["Orange","Apple","Banana"], a:"Orange", emoji:"üçä" },
        { es: "Fresa", en: ["Strawberry","Cherry","Apple"], a:"Strawberry", emoji:"üçì" },
        { es: "Pera", en: ["Pear","Apple","Grape"], a:"Pear", emoji:"üçê" },
        { es: "Pi√±a", en: ["Pineapple","Melon","Kiwi"], a:"Pineapple", emoji:"üçç" },
        { es: "Pan", en: ["Bread","Toast","Cake"], a:"Bread", emoji:"üçû" },
        { es: "Queso", en: ["Cheese","Butter","Yogurt"], a:"Cheese", emoji:"üßÄ" },
        { es: "Pizza", en: ["Pizza","Pasta","Salad"], a:"Pizza", emoji:"üçï" },
        { es: "Huevo", en: ["Egg","Chicken","Milk"], a:"Egg", emoji:"ü•ö" },
        { es: "Leche", en: ["Milk","Water","Juice"], a:"Milk", emoji:"ü•õ" },
        { es: "Az√∫car", en: ["Sugar","Salt","Flour"], a:"Sugar", emoji:"üç¨" },
        { es: "Carne", en: ["Meat","Fish","Poultry"], a:"Meat", emoji:"ü•©" },
        { es: "Pescado", en: ["Fish","Meat","Chicken"], a:"Fish", emoji:"üêü" },
        { es: "Helado", en: ["Ice Cream","Yogurt","Cake"], a:"Ice Cream", emoji:"üç¶" },
        { es: "Zanahoria", en: ["Carrot","Potato","Tomato"], a:"Carrot", emoji:"ü•ï" },
        { es: "Hamburguesa", en: ["Hamburger","Sandwich","Taco"], a:"Hamburger", emoji:"üçî" }
    ],
    objects: [
        { es:"Casa", en:["House","Tree","Car"], a:"House", emoji:"üè†" },
        { es:"Agua", en:["Water","Milk","Juice"], a:"Water", emoji:"üíß" },
        { es:"Coche", en:["Car","Bike","Bus"], a:"Car", emoji:"üöó" },
        { es:"Libro", en:["Book","Notebook","Pen"], a:"Book", emoji:"üìö" },
        { es:"Llave", en:["Key","Lock","Door"], a:"Key", emoji:"üîë" },
        { es:"Mesa", en:["Table","Chair","Desk"], a:"Table", emoji:"ü™ë" },
        { es:"Silla", en:["Chair","Sofa","Couch"], a:"Chair", emoji:"ü™ë" },
        { es:"Tel√©fono", en:["Phone","Tablet","Screen"], a:"Phone", emoji:"üì±" },
        { es:"Reloj", en:["Clock","Watch","Time"], a:"Clock", emoji:"‚è∞" },
        { es:"L√°piz", en:["Pencil","Pen","Eraser"], a:"Pencil", emoji:"‚úèÔ∏è" },
        { es:"Ventana", en:["Window","Door","Wall"], a:"Window", emoji:"ü™ü" },
        { es:"Computadora", en:["Computer","Screen","Keyboard"], a:"Computer", emoji:"üíª" },
        { es:"Televisi√≥n", en:["Television","Radio","Screen"], a:"Television", emoji:"üì∫" },
        { es:"Cama", en:["Bed","Pillow","Blanket"], a:"Bed", emoji:"üõèÔ∏è" },
        { es:"Puerta", en:["Door","Wall","Roof"], a:"Door", emoji:"üö™" },
        { es:"Luz", en:["Light","Darkness","Lamp"], a:"Light", emoji:"üí°" },
        { es:"Espejo", en:["Mirror","Glass","Picture"], a:"Mirror", emoji:"ü™û" },
        { es:"Dinero", en:["Money","Coin","Cash"], a:"Money", emoji:"üí∞" },
        { es:"M√∫sica", en:["Music","Song","Sound"], a:"Music", emoji:"üé∂" }
    ],
    clothes: [
        { es:"Camiseta", en:["T-Shirt","Shirt","Jacket"], a:"T-Shirt", emoji:"üëï" },
        { es:"Pantalones", en:["Pants","Shorts","Skirt"], a:"Pants", emoji:"üëñ" },
        { es:"Zapatos", en:["Shoes","Socks","Boots"], a:"Shoes", emoji:"üëü" },
        { es:"Vestido", en:["Dress","Skirt","Suit"], a:"Dress", emoji:"üëó" },
        { es:"Chaqueta", en:["Jacket","Coat","Sweater"], a:"Jacket", emoji:"üß•" },
        { es:"Calcetines", en:["Socks","Gloves","Hat"], a:"Socks", emoji:"üß¶" },
        { es:"Sombrero", en: ["Hat","Cap","Scarf"], a:"Hat", emoji:"üé©" },
        { es:"Falda", en:["Skirt","Dress","Pants"], a:"Skirt", emoji:"üëó" },
        { es:"Abrigo", en:["Coat","Jacket","Sweater"], a:"Coat", emoji:"üß•" },
        { es:"Guantes", en:["Gloves","Socks","Mittens"], a:"Gloves", emoji:"üß§" },
        { es: "Bufanda", en:["Scarf","Tie","Belt"], a:"Scarf", emoji:"üß£" },
        { es:"Traje", en:["Suit","Dress","Jacket"], a:"Suit", emoji:"üëî" }
    ],
    vehicles: [
        { es:"Coche", en:["Car","Bike","Bus"], a:"Car", emoji:"üöó" },
        { es:"Avi√≥n", en:["Plane","Helicopter","Car"], a:"Plane", emoji:"‚úàÔ∏è" },
        { es:"Bicicleta", en:["Bike","Motorcycle","Car"], a:"Bike", emoji:"üö≤" },
        { es:"Autob√∫s", en:["Bus","Train","Car"], a:"Bus", emoji:"üöå" },
        { es:"Tren", en:["Train","Subway","Tram"], a:"Train", emoji:"üöÜ" },
        { es:"Barco", en:["Boat","Ship","Yacht"], a:"Boat", emoji:"üö¢" },
        { es:"Cami√≥n", en:["Truck","Van","Bus"], a:"Truck", emoji:"üöö" },
        { es:"Motocicleta", en:["Motorcycle","Bike","Scooter"], a:"Motorcycle", emoji:"üèçÔ∏è" },
        { es:"Ambulancia", en:["Ambulance","Police","Fire"], a:"Ambulance", emoji:"üöë" },
        { es:"Taxi", en:["Taxi","Bus","Car"], a:"Taxi", emoji:"üöï" }
    ],
    emotions: [
        { es:"Feliz", en:["Happy","Sad","Angry"], a:"Happy", emoji:"üòä" },
        { es:"Triste", en:["Sad","Happy","Angry"], a:"Sad", emoji:"üò¢" },
        { es:"Enfadado", en:["Angry","Bored","Scared"], a:"Angry", emoji:"üò°" },
        { es:"Sorprendido", en:["Surprised","Confused","Shy"], a:"Surprised", emoji:"üòÆ" },
        { es:"Cansado", en:["Tired","Sleepy","Relaxed"], a:"Tired", emoji:"üò¥" },
        { es:"Aburrido", en:["Bored","Calm","Excited"], a:"Bored", emoji:"üòí" },
        { es:"Asustado", en:["Scared","Brave","Safe"], a:"Scared", emoji:"üò®" },
        { es:"Emocionado", en:["Excited","Calm","Bored"], a:"Excited", emoji:"ü§©" },
        { es:"Confundido", en:["Confused","Clear","Sure"], a:"Confused", emoji:"üòï" },
        { es:"Alegre", en:["Joyful","Gloomy","Tired"], a:"Joyful", emoji:"üòÑ" },
        { es:"Calmado", en:["Calm","Nervous","Excited"], a:"Calm", emoji:"üòå" }
    ],
    sports: [
        { es:"F√∫tbol", en:["Soccer","Basketball","Tennis"], a:"Soccer", emoji:"‚öΩ" },
        { es:"Baloncesto", en:["Basketball","Soccer","Tennis"], a:"Basketball", emoji:"üèÄ" },
        { es:"Tenis", en:["Tennis","Volleyball","Baseball"], a:"Tennis", emoji:"üéæ" },
        { es:"Nataci√≥n", en:["Swimming","Running","Cycling"], a:"Swimming", emoji:"üèä" },
        { es:"B√©isbol", en:["Baseball","Soccer","Golf"], a:"Baseball", emoji:"‚öæ" },
        { es:"Correr", en:["Running","Walking","Jumping"], a:"Running", emoji:"üèÉ" },
        { es:"Voleibol", en:["Volleyball","Handball","Rugby"], a:"Volleyball", emoji:"üèê" },
        { es:"Ciclismo", en:["Cycling","Running","Walking"], a:"Cycling", emoji:"üö¥" },
        { es:"Boxeo", en:["Boxing","Karate","Judo"], a:"Boxing", emoji:"ü•ä" },
        { es:"Golf", en:["Golf","Tennis","Polo"], a:"Golf", emoji:"‚õ≥" },
        { es:"Patinaje", en:["Skating","Skiing","Surfing"], a:"Skating", emoji:"‚õ∏Ô∏è" }
    ],
    actions: [
        { es:"Correr", en:["Run","Walk","Jump"], a:"Run", emoji:"üèÉ" },
        { es:"Comer", en:["Eat","Drink","Sleep"], a:"Eat", emoji:"üçΩÔ∏è" },
        { es:"Beber", en:["Drink","Eat","Sleep"], a:"Drink", emoji:"ü•§" },
        { es:"Dormir", en:["Sleep","Wake","Rest"], a:"Sleep", emoji:"üò¥" },
        { es:"Hablar", en:["Speak","Listen","Say"], a:"Speak", emoji:"üó£Ô∏è" },
        { es:"Escribir", en:["Write","Read","Draw"], a:"Write", emoji:"‚úçÔ∏è" },
        { es:"Leer", en:["Read","Write","Look"], a:"Read", emoji:"üìñ" },
        { es:"Jugar", en:["Play","Work","Study"], a:"Play", emoji:"üéÆ" },
        { es:"Ver", en:["See","Look","Watch"], a:"See", emoji:"üëÄ" },
        { es:"Escuchar", en:["Listen","Hear","Speak"], a:"Listen", emoji:"üëÇ" },
        { es:"Caminar", en:["Walk","Run","Jump"], a:"Walk", emoji:"üö∂‚Äç‚ôÄÔ∏è" },
        { es:"Saltar", en:["Jump","Run","Fly"], a:"Jump", emoji:"ü§∏" },
        { es:"Nadar", en:["Swim","Dive","Float"], a:"Swim", emoji:"üèä" },
        { es:"Cocinar", en:["Cook","Bake","Eat"], a:"Cook", emoji:"üç≥" },
        { es:"Bailar", en:["Dance","Sing","Move"], a:"Dance", emoji:"üíÉ" }
    ]
};


// ====================================================================
// üéÆ L√ìGICA DEL JUEGO (GAME LOGIC)
// ====================================================================

let selectedCategory = null;
let selectedDifficulty = null;
let score = 0;
// highscore se carga desde el almacenamiento local
let highScore = localStorage.getItem("highScore") || 0; 
let lives = 5; // Valor por defecto
let timer = 60;
let timerInterval;
let wordDeck = []; // üÜï NUEVO: Pila de palabras para la ronda actual (para evitar repeticiones)


// Funci√≥n para mostrar una celebraci√≥n temporal (fondo verde)
function celebrate() {
    document.body.style.backgroundColor = '#ccffcc'; 
    setTimeout(() => {
        document.body.style.backgroundColor = '#ffffff'; 
    }, 400); // 400ms de celebraci√≥n
}

// Funci√≥n para mostrar un error temporal (fondo rojo)
function showMistake() {
    document.body.style.backgroundColor = '#ffcccc'; 
    setTimeout(() => {
        document.body.style.backgroundColor = '#ffffff'; 
    }, 400); // 400ms de error
}

// Funci√≥n auxiliar para mezclar un array (Algoritmo Fisher-Yates)
function shuffle(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
}

// Funci√≥n auxiliar para manejar la selecci√≥n visual de botones
function handleSelection(type, element) {
    const allMenuButtons = document.getElementById('menu').querySelectorAll('.menu-btn');
    
    // Limpiamos la clase 'selected' solo de los botones del grupo
    if (type === 'category') {
        // Los primeros 9 botones son categor√≠as
        Array.from(allMenuButtons).slice(0, 9).forEach(b => b.classList.remove('selected'));
    } else if (type === 'difficulty') {
        // Los botones 10, 11 y 12 son dificultades
        Array.from(allMenuButtons).slice(9, 12).forEach(b => b.classList.remove('selected'));
    }

    // A√±adir la clase 'selected' al bot√≥n presionado
    element.classList.add('selected');
}

// Ahora recibe el elemento (this) para la selecci√≥n visual
function selectCategory(cat, element){ 
    selectedCategory = cat; 
    handleSelection('category', element);
}

// Ahora recibe el elemento (this) para la selecci√≥n visual
function selectDifficulty(diff, element){ 
    selectedDifficulty = diff; 
    handleSelection('difficulty', element);
}

function startGame(){
    if(!selectedCategory || !selectedDifficulty){
        // Usar mensaje box en lugar de alert
        document.getElementById("question").innerText = "‚ùå Debes seleccionar categor√≠a y dificultad para iniciar";
        setTimeout(() => document.getElementById("question").innerText = "", 2000);
        return;
    }
    document.getElementById("menu").style.display = "none";
    document.getElementById("game").style.display = "block";
    score = 0;
    
    // ‚¨áÔ∏è L√ìGICA DE VIDAS POR DIFICULTAD
    if (selectedDifficulty === 'easy') {
        lives = 5;
    } else if (selectedDifficulty === 'medium') {
        lives = 3;
    } else if (selectedDifficulty === 'hard') {
        lives = 2;
    }
    
    // Asigna tiempo basado en la dificultad
    timer = selectedDifficulty === "easy" ? 60 : selectedDifficulty === "medium" ? 45 : 30; 
     
    // üÜï NUEVO: Cargar y mezclar todas las palabras de la categor√≠a seleccionada
    wordDeck = shuffle([...WORDS[selectedCategory]]);
    
    document.getElementById("score").innerText = "Puntos: " + score;
    document.getElementById("lives").innerText = "Vidas: " + "‚ù§Ô∏è".repeat(lives);
    // Asegura que el highscore mostrado sea un n√∫mero
    document.getElementById("highscore").innerText = "Puntaje m√°s alto: " + highScore; 
    document.getElementById("timer").innerText = "Tiempo: " + timer;
    
    clearInterval(timerInterval); // Limpia cualquier intervalo previo
    timerInterval = setInterval(()=>{
        timer--;
        document.getElementById("timer").innerText = "Tiempo: " + timer;
        // Llama a endGame con 'time_out'
        if(timer <= 0) endGame('time_out'); 
    }, 1000);
    nextWord();
}

function nextWord(){
    // Llama a endGame con 'lives_out'
    if(lives <= 0){ endGame('lives_out'); return; } 
    
    // üÜï NUEVO: Verificar si quedan palabras en el deck
    if (wordDeck.length === 0) {
        // Si el jugador respondi√≥ todas las palabras de la categor√≠a, termina el juego.
        endGame('category_complete'); 
        return;
    }

    // üÜï NUEVO: Saca la primera palabra del deck (FIFO)
    const word = wordDeck.shift(); 
    
    document.getElementById("question").innerText = `${word.emoji} ¬øC√≥mo se dice "${word.es}" en ingl√©s?`;
    
    const optionsDiv = document.getElementById("options");
    optionsDiv.innerHTML = "";
    
    // Clonar y mezclar las opciones (para evitar modificar el array original)
    const shuffledOptions = [...word.en].sort(()=>Math.random()-0.5);
    
    shuffledOptions.forEach(opt=>{
        const btn = document.createElement("button");
        btn.className = "word-btn";
        btn.innerText = opt;
        optionsDiv.appendChild(btn); // Primero a√±adimos el bot√≥n al DOM
        
        // Capturamos todos los botones que acabamos de crear
        const optionsButtons = Array.from(optionsDiv.children);

        btn.onclick = (event)=>{
            // Desactivar todos los botones para prevenir m√∫ltiples clics
            optionsButtons.forEach(b => b.disabled = true); 

            if(opt === word.a){
                score += 10;
                btn.classList.add("correct");
                celebrate(); 
            } else {
                lives--;
                btn.classList.add("incorrect");
                showMistake();
                // Resaltar la respuesta correcta
                optionsButtons.find(b => b.innerText === word.a).classList.add("correct");
            }
            
            document.getElementById("score").innerText = "Puntos: " + score;
            document.getElementById("lives").innerText = "Vidas: " + "‚ù§Ô∏è".repeat(lives);
            
            // Actualizar HighScore
            const currentHighScore = parseInt(localStorage.getItem("highScore") || 0);
            if(score > currentHighScore){ 
                highScore = score; 
                localStorage.setItem("highScore", highScore); 
            }
            document.getElementById("highscore").innerText = "Puntaje m√°s alto: " + highScore;
            
            // Espera para ver el feedback. Aumentado a 1000ms para mejor visualizaci√≥n
            setTimeout(nextWord, 1000); 
        };
    });
}

// MODIFICADO: Ahora recibe la raz√≥n del fin del juego (lives_out, time_out o category_complete)
function endGame(reason){ 
    clearInterval(timerInterval);
    document.getElementById("game").style.display = "none";
    document.getElementById("scoreboard").style.display = "block";
    
    // --- NUEVA L√ìGICA DE MENSAJE DE P√âRDIDA/VICTORIA ---
    const endTitle = document.getElementById("scoreboard").querySelector("h2");
    
    if (reason === 'lives_out') {
        endTitle.innerHTML = "¬°Juego terminado! üò≠ Se te acabaron las vidas.";
    } else if (reason === 'time_out') {
        endTitle.innerHTML = "¬°Juego terminado! ‚è±Ô∏è Se te acab√≥ el tiempo.";
    } else if (reason === 'category_complete') {
        endTitle.innerHTML = "üéâ ¬°CATEGOR√çA COMPLETADA! ¬°Impresionante! üéâ";
    } else {
        endTitle.innerHTML = "¬°Juego terminado! üèÜ";
    }
    // ------------------------------------------
    
    document.getElementById("final-score").innerText = `Tu puntaje final es: ${score}`;
    
    const storedHighScore = localStorage.getItem("highScore") || 0;
    document.getElementById("final-highscore").innerText = `Puntaje m√°s alto: ${storedHighScore}`;
    
    const finalMessageElement = document.getElementById("final-message");

    // L√≥gica de felicitaci√≥n/√°nimo
    if (score > storedHighScore) {
        finalMessageElement.innerHTML = `üéâ **¬°FENOMENAL! ¬°Has establecido un NUEVO R√âCORD de ${score} puntos!** ü•≥`;
    } else if (score == storedHighScore && score > 0) {
        finalMessageElement.innerHTML = `üåü **¬°Incre√≠ble desempe√±o! ¬°Igualaste tu mejor marca!** üëè`;
    } else if (score > 0) {
        finalMessageElement.innerHTML = `‚ú® **¬°Excelente esfuerzo! Sigue as√≠. ¬°Con un poco m√°s de pr√°ctica, superar√°s ese r√©cord!** üí™`;
    } else {
        finalMessageElement.innerHTML = `üòî **Sigue practicando. Cada error es una lecci√≥n. ¬°Vuelve a intentarlo!** üëç`;
    }
}

function restartGame(){
    document.getElementById("scoreboard").style.display = "none";
    document.getElementById("menu").style.display = "block";
    selectedCategory = null;
    selectedDifficulty = null;
    
    // üßπ Limpia visualmente las selecciones al volver al men√∫
    document.getElementById('menu').querySelectorAll('.menu-btn').forEach(btn => {
        btn.classList.remove('selected');
    });
}

// Mostrar men√∫ al cargar
document.getElementById("menu").style.display = "block";
</script>

</body>
</html>
